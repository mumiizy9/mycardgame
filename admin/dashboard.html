
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Dashboard - Card Game Backoffice</title>
  <link rel="stylesheet" href="admin.css">
  <style>
    body { background: #eeeff8; font-family: 'Kanit', sans-serif; margin:0;}
    .dash-container { max-width:1400px; margin:auto; padding:2em 1em; }
    .dash-header { display: flex; align-items:center; margin-bottom:1.5em; }
    .dash-header .dash-title { font-size: 2.1em; font-weight: bold; color: #24678b; margin-right:1.2em;}
    .dash-user { color: #6e7b96; font-size:1.02em; margin-left:auto; }
    .dash-nav { display:flex; gap:2em; margin-bottom: 1.5em; flex-wrap:wrap; }
    .dash-nav button { background:#2f85fa; color:#fff; border:0; border-radius:8px; padding:11px 22px; font-size:1.12em; cursor:pointer; font-weight:600; box-shadow:0 2px 10px #d1e7fb30; transition: background 0.17s;}
    .dash-nav button.active, .dash-nav button:focus {background: #16ca90;}
    .dash-section { display:none; background:#fff; border-radius:18px; box-shadow:0 2px 16px #c0d8fc49; padding:2em 2.4em 2em 2em; margin-bottom:2em;}
    .dash-section.active { display:block; animation:fadeIn 0.3s;}
    .dash-panel-title {color:#1c5ca3; margin-bottom:1.1em; font-size:1.38em; font-weight:bold; letter-spacing:1px;}
    .logout-btn { background: #e32536; color: #fff; border: 0; border-radius: 7px; padding: 9px 18px; font-size: 1em; font-weight: bold; cursor:pointer; margin-left:20px;}
    .dash-footer { text-align:center; padding:.8em 0; color:#7b8ebd; font-size:0.97em;}
    /* Table */
    table { border-collapse: collapse; width: 100%; margin: 20px 0;}
    th, td {border:1px solid #d0d8e4; padding:8px 13px; text-align:left;}
    th {background:#e6f2fe;}
    tr td:first-child {font-weight:bold;}
    .admin-edit-btn, .admin-del-btn, .admin-save-btn, .admin-cancel-btn {padding:2px 15px; border-radius:5px; border:0; font-size:.97em; margin:0 2px; cursor:pointer;}
    .admin-edit-btn { background: #0682c2; color:#fff;}
    .admin-del-btn { background: #e93523; color:#fff;}
    .admin-save-btn { background: #14a15a; color:#fff;}
    .admin-cancel-btn { background: #ddd; color:#1d1d1d;}
    .admin-add-btn { background: #377fe9;color:#fff;border:0;padding:8px 19px;border-radius:7px;margin:12px 0;cursor:pointer;font-size:1em;}
    .dash-table {overflow-x:auto;}
    .input-text, input[type="number"], select {
      font-family: inherit; padding:3px 9px; border-radius:5px; border:1px solid #abcdf3; font-size:1em;
    }
    @keyframes fadeIn {from{opacity:0;}to{opacity:1;}}
    @media (max-width: 700px){
      .dash-section {padding:1em .3em;}
      .dash-container {padding:1em .2em;}
      .dash-header .dash-title {font-size:1.36em;}
      .dash-nav button {font-size:1em;padding:8px 10px;}
    }
  </style>
</head>
<body>
  <div class="dash-container">
    <div class="dash-header">
      <span class="dash-title">üõ°Ô∏è ADMIN DASHBOARD</span>
      <span id="admin-username" class="dash-user">Loading...</span>
      <button class="logout-btn" onclick="logoutAdmin()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
    <nav class="dash-nav" id="nav-tabs">
      <button onclick="showSection('character-admin')" id="tab-character" class="active">üë§ ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£</button>
      <button onclick="showSection('gacha-admin')" id="tab-gacha">üé≤ ‡∏Å‡∏≤‡∏ä‡∏≤</button>
      <button onclick="showSection('equipment-admin')" id="tab-equip">‚öîÔ∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
      <button onclick="showSection('stages-admin')" id="tab-stage">üó∫Ô∏è ‡∏î‡πà‡∏≤‡∏ô/Stage</button>
      <button onclick="showSection('quests-admin')" id="tab-quest">üèÜ ‡πÄ‡∏Ñ‡∏ß‡∏™</button>
      <button onclick="showSection('shop-admin')" id="tab-shop">üõí ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      <button onclick="showSection('notify-admin')" id="tab-notify">üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®/‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
    </nav>

    <!-- CHARACTER -->
    <section class="dash-section active" id="character-admin">
      <div class="dash-panel-title">üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ (characters.json)</div>
      <div class="dash-table" id="table-characters"></div>
      <button class="admin-add-btn" onclick="adminAddRow('characters')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£</button>
    </section>

    <!-- GACHA -->
    <section class="dash-section" id="gacha-admin">
      <div class="dash-panel-title">üé≤ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏ä‡∏≤ (gacha.json)</div>
      <div class="dash-table" id="table-gacha"></div>
      <button class="admin-add-btn" onclick="adminAddRow('gacha')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏° Pool ‡∏Å‡∏≤‡∏ä‡∏≤</button>
    </section>

    <!-- EQUIPMENT -->
    <section class="dash-section" id="equipment-admin">
      <div class="dash-panel-title">‚öîÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (equipment.json)</div>
      <div class="dash-table" id="table-equipment"></div>
      <button class="admin-add-btn" onclick="adminAddRow('equipment')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
    </section>

    <!-- STAGES -->
    <section class="dash-section" id="stages-admin">
      <div class="dash-panel-title">üó∫Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏≤‡∏ô/Stage (stages.json)</div>
      <div class="dash-table" id="table-stages"></div>
      <button class="admin-add-btn" onclick="adminAddRow('stages')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡πà‡∏≤‡∏ô</button>
      <small style="color:#2571bf;"><b>üìñ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç world/dungeon/stage/boss</b> ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏∏‡∏î, ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ñ‡∏ß‡∏£‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà</small>
    </section>

    <!-- QUESTS -->
    <section class="dash-section" id="quests-admin">
      <div class="dash-panel-title">üèÜ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏ß‡∏™ (quests.json)</div>
      <div class="dash-table" id="table-quests"></div>
      <button class="admin-add-btn" onclick="adminAddRow('quests')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏ß‡∏™</button>
    </section>

    <!-- SHOP -->
    <section class="dash-section" id="shop-admin">
      <div class="dash-panel-title">üõí ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (shop.json)</div>
      <div class="dash-table" id="table-shop"></div>
      <button class="admin-add-btn" onclick="adminAddRow('shop')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
    </section>

    <!-- NOTIFY -->
    <section class="dash-section" id="notify-admin">
      <div class="dash-panel-title">üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®/‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡πÉ‡∏ô FriendEventUI.js)</div>
      <div class="dash-table" id="table-notify"></div>
      <button class="admin-add-btn" onclick="adminAddRow('notify')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà</button>
    </section>

    <div class="dash-footer">
      CardGame Admin | Powered by Backoffice Template | &copy; 2024 | <span id="admin-ft-user"></span>
    </div>
  </div>

  <script src="admin.js"></script>
  <script>
    // -- Admin Auth Protect --
    console.log("sessionStorage", sessionStorage.getItem("isAdmin"), sessionStorage.getItem("adminUser"));
    if (!sessionStorage.getItem('isAdmin')) {
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
      window.location.href = 'login.html';
    }
    // -- Update user info --
    const adminUser = sessionStorage.getItem('adminUser');
    document.getElementById('admin-username').textContent = 'üë§ ' + adminUser;
    document.getElementById('admin-ft-user').textContent = 'Admin: ' + adminUser;

    // -- Section switching (tabs) --
    function showSection(id) {
      document.querySelectorAll('.dash-section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      // Tab UI
      document.querySelectorAll('.dash-nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('tab-'+id.split('-')[0]).classList.add('active');
    }

    // -- Logout --
    function logoutAdmin() {
      sessionStorage.clear();
      window.location.href = 'login.html';
    }
  </script>
  <script>
    // ----- DYNAMIC TABLES: Auto fetch json and render, editable -----
    // Load data for each section (file)
    let adminData = {characters:[], gacha:[], equipment:[], stages:[], quests:[], shop:[], notify:[]};

    // Helper: Load and render all admin tables
    async function loadAdminData() {
      // Load data from json files (local fetch)
      // 1. Characters
      adminData.characters = await fetch('../data/characters.json').then(r=>r.json()).catch(()=>[]);
      // 2. Gacha
      let gachaRaw = await fetch('../data/gacha.json').then(r=>r.json()).catch(()=>({gacha_pool:[],gacha_cost:1000}));
      adminData.gacha = gachaRaw.gacha_pool || [];
      adminData.gachaCost = gachaRaw.gacha_cost || 1000;
      // 3. Equipment
      adminData.equipment = await fetch('../data/equipment.json').then(r=>r.json()).catch(()=>[]);
      // 4. Stages
      adminData.stages = await fetch('../data/stages.json').then(r=>r.json()).catch(()=>[]);
      // 5. Quests
      let questsRaw = await fetch('../data/quests.json').then(r=>r.json()).catch(()=>({main:[],daily:[],side:[]}));
      adminData.quests = [
        ...(questsRaw.main||[]).map(q=>({...q,type:'‡∏´‡∏•‡∏±‡∏Å'})),
        ...(questsRaw.daily||[]).map(q=>({...q,type:'‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô'})),
        ...(questsRaw.side||[]).map(q=>({...q,type:'Side'}))
      ];
      // 6. Shop
      adminData.shop = await fetch('../data/shop.json').then(r=>r.json()).catch(()=>[]);
      // 7. Notify (from local storage or default)
      adminData.notify = JSON.parse(localStorage.getItem('adminNotifyList') || '[]');
      if(!adminData.notify.length){
        adminData.notify = [
          {type:"announce",icon:"üì¢",msg:"‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡∏°‡πà!",time:"‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"},
          {type:"reward",icon:"üéÅ",msg:"‡πÅ‡∏à‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà!",time:"‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ"}
        ];
      }
      // Render all tables
      renderCharTable();
      renderGachaTable();
      renderEquipTable();
      renderStageTable();
      renderQuestTable();
      renderShopTable();
      renderNotifyTable();
    }
    window.onload = loadAdminData;

    // -- Each Table Renderers and Editors --
    function htmlInput(val,name,type='text',extra=''){ return `<input class='input-text' type='${type}' name='${name}' value='${val||""}' ${extra}/>`; }
    function adminAddRow(section){
      switch(section){
        case 'characters': adminData.characters.push({id:'id'+Date.now(),name:'',job:'',element:'Fire',level:1,rarity:3,stats:{hp:1000,atk:100,def:100,spd:80},skills:[]}); break;
        case 'gacha': adminData.gacha.push({character_id:'',weight:100}); break;
        case 'equipment': adminData.equipment.push({id:'id'+Date.now(),name:'',type:'Weapon',element:'Fire',bonus:{atk:0},description:''}); break;
        case 'stages': if(adminData.stages.length){adminData.stages[0].stages.push(
          {id:'',name:'',enemies:[],reward:{gold:100,item:''},boss:null}
        );}else{adminData.stages.push({world:1,name:'World',stages:[{id:'',name:'',enemies:[],reward:{gold:100,item:''},boss:null}]});} break;
        case 'quests': adminData.quests.push({id:'',name:'',desc:'',icon:'üèÜ',require:{},reward:{gold:100},type:'‡∏´‡∏•‡∏±‡∏Å'}); break;
        case 'shop': adminData.shop.push({id:'id'+Date.now(),name:'',icon:'üéâ',desc:'',price:10,limit_per_day:1}); break;
        case 'notify': adminData.notify.push({type:'announce',icon:'üì¢',msg:'',time:'‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ'}); break;
      }
      renderTablesBySection(section);
    }
    function renderTablesBySection(section){
      switch(section){
        case 'characters': renderCharTable(); break;
        case 'gacha': renderGachaTable(); break;
        case 'equipment': renderEquipTable(); break;
        case 'stages': renderStageTable(); break;
        case 'quests': renderQuestTable(); break;
        case 'shop': renderShopTable(); break;
        case 'notify': renderNotifyTable(); break;
      }
    }
    // CHARACTER TABLE
    function renderCharTable(){
      let rows = adminData.characters.map((c,i)=>`
        <tr>
         <td>${htmlInput(c.id,'id')}</td>
         <td>${htmlInput(c.name,'name')}</td>
         <td>${htmlInput(c.job,'job')}</td>
         <td><select name='element'>${["Fire","Water","Earth","Wind","Dark","Light"].map(e=>`<option ${c.element==e?'selected':''}>${e}</option>`)}</select></td>
         <td>${htmlInput(c.level,'level','number','min=1')}</td>
         <td>${htmlInput(c.rarity,'rarity','number','min=1 max=6')}</td>
         <td>HP:${htmlInput(c.stats.hp,'stats.hp','number','min=1')}<br>ATK:${htmlInput(c.stats.atk,'stats.atk','number','min=0')}<br>DEF:${htmlInput(c.stats.def,'stats.def','number','min=0')}<br>SPD:${htmlInput(c.stats.spd,'stats.spd','number','min=0')}</td>
         <td>${htmlInput((c.skills||[]).join(", "),'skills')}</td>
         <td>
           <button class='admin-save-btn' onclick='adminSaveChar(${i})'>üíæ</button>
           <button class='admin-del-btn' onclick='adminDelRow("characters",${i})'>üóëÔ∏è</button>
         </td>
        </tr>
      `).join('');
      document.getElementById("table-characters").innerHTML = `
        <table>
         <thead><tr>
           <th>ID</th><th>Name</th><th>Job</th><th>Element</th><th>LV</th><th>Rarity</th>
           <th>Stats</th><th>Skills (comma)</th><th>Action</th>
         </tr></thead>
         <tbody>${rows}</tbody>
        </table>`;
    }
    window.adminSaveChar = function(idx){
      // update object from input
      const t = document.getElementById("table-characters").getElementsByTagName('tbody')[0].rows[idx];
      const c = adminData.characters[idx];
      c.id = t.cells[0].querySelector('input[name="id"]').value;
      c.name = t.cells[1].querySelector('input[name="name"]').value;
      c.job = t.cells[2].querySelector('input[name="job"]').value;
      c.element = t.cells[3].querySelector('select[name="element"]').value;
      c.level = parseInt(t.cells[4].querySelector('input[name="level"]').value||1);
      c.rarity = parseInt(t.cells[5].querySelector('input[name="rarity"]').value||3);
      c.stats.hp = parseInt(t.cells[6].querySelector('input[name="stats.hp"]').value||1000);
      c.stats.atk = parseInt(t.cells[6].querySelector('input[name="stats.atk"]').value||100);
      c.stats.def = parseInt(t.cells[6].querySelector('input[name="stats.def"]').value||100);
      c.stats.spd = parseInt(t.cells[6].querySelector('input[name="stats.spd"]').value||80);
      c.skills = (t.cells[7].querySelector('input[name="skills"]').value||'').split(',').map  .trim();
      alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢)");
      renderCharTable();
      // TODO: ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô export/save json ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏Å‡∏•‡∏±‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏•‡∏±‡∏ö server ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏°‡∏µ
    }
    window.adminDelRow = function(section,i){
      if(confirm("‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ?")) {
        adminData[section].splice(i,1);
        renderTablesBySection(section);
      }
    }

    // GACHA TABLE
    function renderGachaTable(){
      let rows = adminData.gacha.map((g,i)=>`
        <tr>
          <td>${htmlInput(g.character_id,'character_id')}</td>
          <td>${htmlInput(g.weight,'weight','number','min=1')}</td>
          <td>
            <button class='admin-save-btn' onclick='adminSaveGacha(${i})'>üíæ</button>
            <button class='admin-del-btn' onclick='adminDelRow("gacha",${i})'>üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
      document.getElementById("table-gacha").innerHTML = `
        <table>
          <thead><tr>
            <th>‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£</th><th>Weight</th><th>Action</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>
        <div style="margin-top:0.6em">‡∏Ñ‡πà‡∏≤ Gold ‡∏ï‡πà‡∏≠ 1 Roll: <input id="gacha-cost-input" type="number" value="${adminData.gachaCost||1000}" style="width:90px" min="1"/>
        <button onclick="saveGachaCost()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤</button></div>
      `;
    }
    window.adminSaveGacha = function(idx){
      const t = document.getElementById("table-gacha").getElementsByTagName('tbody')[0].rows[idx];
      const g = adminData.gacha[idx];
      g.character_id = t.cells[0].querySelector('input[name="character_id"]').value.trim();
      g.weight = parseInt(t.cells[1].querySelector('input[name="weight"]').value||1);
      alert('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Pool ‡∏Å‡∏≤‡∏ä‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      renderGachaTable();
    }
    window.saveGachaCost = function(){
      adminData.gachaCost = parseInt(document.getElementById('gacha-cost-input').value)||1000;
      alert('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤ Roll ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    }

    // EQUIPMENT TABLE
    function renderEquipTable(){
      let rows = adminData.equipment.map((e,i)=>`
        <tr>
          <td>${htmlInput(e.id,'id')}</td>
          <td>${htmlInput(e.name,'name')}</td>
          <td>${htmlInput(e.type,'type')}</td>
          <td>${htmlInput(e.element,'element')}</td>
          <td>${htmlInput(JSON.stringify(e.bonus||{}),'bonus')}</td>
          <td>${htmlInput(e.description,'description')}</td>
          <td>
            <button class='admin-save-btn' onclick='adminSaveEquip(${i})'>üíæ</button>
            <button class='admin-del-btn' onclick='adminDelRow("equipment",${i})'>üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
      document.getElementById("table-equipment").innerHTML = `
        <table>
          <thead><tr>
            <th>ID</th><th>Name</th><th>Type</th><th>Element</th><th>‡πÇ‡∏ö‡∏ô‡∏±‡∏™ (JSON)</th><th>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</th><th>Action</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    }
    window.adminSaveEquip = function(idx){
      const t = document.getElementById("table-equipment").getElementsByTagName('tbody')[0].rows[idx];
      const e = adminData.equipment[idx];
      e.id = t.cells[0].querySelector('input[name="id"]').value;
      e.name = t.cells[1].querySelector('input[name="name"]').value;
      e.type = t.cells[2].querySelector('input[name="type"]').value;
      e.element = t.cells[3].querySelector('input[name="element"]').value;
      try{ e.bonus = JSON.parse(t.cells[4].querySelector('input[name="bonus"]').value);}catch{ e.bonus={}; }
      e.description = t.cells[5].querySelector('input[name="description"]').value;
      alert('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      renderEquipTable();
    }

    // STAGES TABLE (short, edit by JSON)
    function renderStageTable(){
      let rows = adminData.stages.map((w,wi)=>`
        <tr>
          <td>${htmlInput(w.world,'world','number','min=1')}</td>
          <td>${htmlInput(w.name,'name')}</td>
          <td><textarea style="width:100%;height:90px" name="stages">${JSON.stringify(w.stages,null,2)}</textarea></td>
          <td>
            <button class='admin-save-btn' onclick='adminSaveStage(${wi})'>üíæ</button>
          </td>
        </tr>
      `).join('');
      document.getElementById("table-stages").innerHTML = `
        <table>
          <thead><tr>
            <th>World</th><th>Name</th><th>Stages (JSON)</th><th>Action</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>
        <div style="color:#f80;">* ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô array JSON ‡πÄ‡∏ï‡πá‡∏°‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>`;
    }
    window.adminSaveStage = function(worldIdx){
      const t = document.getElementById("table-stages").getElementsByTagName('tbody')[0].rows[worldIdx];
      let w = adminData.stages[worldIdx];
      w.world = parseInt(t.cells[0].querySelector('input[name="world"]').value)||1;
      w.name = t.cells[1].querySelector('input[name="name"]').value;
      try{ w.stages = JSON.parse(t.cells[2].querySelector('textarea[name="stages"]').value);}catch{w.stages=[];}
      alert('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å World ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      renderStageTable();
    }

    // QUESTS TABLE
    function renderQuestTable(){
      let rows = adminData.quests.map((q,i)=>`
        <tr>
          <td>${htmlInput(q.id,'id')}</td>
          <td>${htmlInput(q.type||'','type')}</td>
          <td>${htmlInput(q.name,'name')}</td>
          <td>${htmlInput(q.desc,'desc')}</td>
          <td>${htmlInput(q.icon,'icon')}</td>
          <td>${htmlInput(JSON.stringify(q.require||{}),'require')}</td>
          <td>${htmlInput(JSON.stringify(q.reward||{}),'reward')}</td>
          <td>
            <button class='admin-save-btn' onclick='adminSaveQuest(${i})'>üíæ</button>
            <button class='admin-del-btn' onclick='adminDelRow("quests",${i})'>üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
      document.getElementById("table-quests").innerHTML = `
        <table>
          <thead><tr>
            <th>ID</th><th>Type</th><th>Name</th><th>Desc</th><th>Icon</th><th>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (JSON)</th><th>‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (JSON)</th><th>Action</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    }
    window.adminSaveQuest = function(idx){
      const t = document.getElementById("table-quests").getElementsByTagName('tbody')[0].rows[idx];
      const q = adminData.quests[idx];
      q.id = t.cells[0].querySelector('input[name="id"]').value;
      q.type = t.cells[1].querySelector('input[name="type"]').value;
      q.name = t.cells[2].querySelector('input[name="name"]').value;
      q.desc = t.cells[3].querySelector('input[name="desc"]').value;
      q.icon = t.cells[4].querySelector('input[name="icon"]').value;
      try{q.require=JSON.parse(t.cells[5].querySelector('input[name="require"]').value);}catch{q.require={};}
      try{q.reward=JSON.parse(t.cells[6].querySelector('input[name="reward"]').value);}catch{q.reward={};}
      alert('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ñ‡∏ß‡∏™‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      renderQuestTable();
    }

    // SHOP TABLE
    function renderShopTable(){
      let rows = adminData.shop.map((s,i)=>`
        <tr>
          <td>${htmlInput(s.id,'id')}</td>
          <td>${htmlInput(s.name,'name')}</td>
          <td>${htmlInput(s.icon,'icon')}</td>
          <td>${htmlInput(s.desc,'desc')}</td>
          <td>${htmlInput(s.price,'price','number','min=0')}</td>
          <td>${htmlInput(s.limit_per_day,'limit_per_day','number','min=1')}</td>
          <td>
            <button class='admin-save-btn' onclick='adminSaveShop(${i})'>üíæ</button>
            <button class='admin-del-btn' onclick='adminDelRow("shop",${i})'>üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
      document.getElementById("table-shop").innerHTML = `
        <table>
          <thead><tr>
            <th>ID</th><th>Name</th><th>Icon</th><th>Desc</th><th>Price</th><th>Limit/Day</th><th>Action</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    }
    window.adminSaveShop = function(idx){
      const t = document.getElementById("table-shop").getElementsByTagName('tbody')[0].rows[idx];
      const s = adminData.shop[idx];
      s.id = t.cells[0].querySelector('input[name="id"]').value;
      s.name = t.cells[1].querySelector('input[name="name"]').value;
      s.icon = t.cells[2].querySelector('input[name="icon"]').value;
      s.desc = t.cells[3].querySelector('input[name="desc"]').value;
      s.price = parseInt(t.cells[4].querySelector('input[name="price"]').value);
      s.limit_per_day = parseInt(t.cells[5].querySelector('input[name="limit_per_day"]').value);
      alert('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      renderShopTable();
    }

    // NOTIFY TABLE (local only!)
    function renderNotifyTable(){
      let rows = adminData.notify.map((n,i)=>`
        <tr>
          <td>${htmlInput(n.type,'type')}</td>
          <td>${htmlInput(n.icon,'icon')}</td>
          <td>${htmlInput(n.msg,'msg')}</td>
          <td>${htmlInput(n.time,'time')}</td>
          <td>
            <button class='admin-save-btn' onclick='adminSaveNotify(${i})'>üíæ</button>
            <button class='admin-del-btn' onclick='adminDelRow("notify",${i});saveNotifyLocal()'>üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
      document.getElementById("table-notify").innerHTML = `
        <table>
          <thead><tr>
            <th>Type</th><th>Icon</th><th>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</th><th>Time</th><th>Action</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>
        <div style="color:#09a;text-align:right">*‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ localStorage ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô FriendEventUI.js ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</div>
      `;
      saveNotifyLocal();
    }
    function saveNotifyLocal(){
      localStorage.setItem('adminNotifyList',JSON.stringify(adminData.notify));
    }
    window.adminSaveNotify = function(idx){
      const t = document.getElementById("table-notify").getElementsByTagName('tbody')[0].rows[idx];
      const n = adminData.notify[idx];
      n.type = t.cells[0].querySelector('input[name="type"]').value;
      n.icon = t.cells[1].querySelector('input[name="icon"]').value;
      n.msg = t.cells[2].querySelector('input[name="msg"]').value;
      n.time = t.cells[3].querySelector('input[name="time"]').value;
      alert('üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      renderNotifyTable();
    }
    // -- Export for external use --
    window.adminDelRow = adminDelRow;

    // -- Export JSON for download --
    // TODO: ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Export ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î
    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: function download(filename, data) { ... }
    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô version ‡∏ï‡πà‡∏≠‡πÑ‡∏õ

  </script>
</body>
</html>
