<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>เข้าสู่ระบบ</title>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body class="dark-bg">
    <main style="max-width:400px;margin:75px auto 0 auto;background:#23253c;border-radius:14px;box-shadow:0 1px 31px #123c;padding:32px 22px 30px 22px;">
        <h2 style="text-align:center;">เข้าสู่ระบบ</h2>
        <div id="loginErrorMsg" style="color:#f77;font-size:.93em;"></div>
        <form id="loginForm" autocomplete="on">
            <input id="auth_user_id" placeholder="User ID..." autocomplete="username" style="width:100%;margin-bottom:11px;" /><br>
            <input id="auth_user_pw" type="password" placeholder="Password..." autocomplete="current-password" style="width:100%;margin-bottom:16px;" /><br>
            <button class="primary-btn" style="width:100%;" type="submit">ล็อกอิน</button>
        </form>
        <div style="text-align:center;margin-top:23px;">
            <a href="index.html" style="color:#9df;text-decoration:underline;font-size:.97em;">กลับหน้าหลัก</a>
        </div>
    </main>
    <script src="js/auth.js"></script>
    <script>
    document.getElementById('loginForm').onsubmit = async function(e){
        e.preventDefault();
        let id = document.getElementById('auth_user_id').value.trim();
        let pw = document.getElementById('auth_user_pw').value;
        let el = document.getElementById('loginErrorMsg');
        // โหลด user.json ถ้ายังไม่โหลด
        if(typeof window.users==="undefined"||!window.users.length) await fetch('data/user.json').then(r=>r.json()).then(arr=>window.users=arr);
        let user = window.users.find(u => u.id === id && u.password === pw && u.enabled !== false);
        if (user) {
            localStorage.setItem('user_id', user.id);
            localStorage.setItem('user_name', user.name);
            localStorage.setItem('user_is_admin', user.role === "admin" ? "1" : "0");
            location.href = "index.html";
        } else {
            el.innerText = "รหัสผ่านหรือชื่อผู้ใช้ไม่ถูกต้อง!";
        }
    }
    </script>
</body>
</html>